C51 COMPILER V9.54   MAIN                                                                  09/18/2024 17:47:02 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil5 C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ma
                    -in.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          #include "Timer0.h"
   4          #include "Timer1.h"
   5          #include "MatrixKey.h"
   6          #include "Key.h"
   7          #include "DS18B20.h"
   8          #include "XPT2406.h"
   9          
  10          sbit Motor=P1^0;
  11          //é€šç”¨å‚æ•°ï¼ˆä¸»çŠ¶æ€æ ‡å¿—ä½â€”â€”é€‰æ‹©èœå•åŠŸèƒ½ï¼Œè¯†åˆ«çŸ©é˜µé”®ç›˜æŒ‰é”®ï¼Œè¯†åˆ«ç‹¬ç«‹é”®ç›
             -˜æŒ‰é”®ï¼Œæ¬¡æ•°ï¼‰
  12          unsigned char Main_Flag,Mar_KeyNum,Key_KeyNum,PWD_Count;
  13          //å¼€å§‹è¾“å…¥å¯†ç å‚æ•°
  14          unsigned int PassWord;
  15          //å¤šåŠŸèƒ½èœå•é€‰æ‹©å‚æ•°
  16          unsigned char Fun_Temp;
  17          //å®æ—¶æ¸©åº¦ç›‘æµ‹å‚æ•°
  18          float T;
  19          //é£æ‰‡æ§é€Ÿå‚æ•°
  20          unsigned char Compare,Fan_Speed;
  21          //å®æ—¶ç›‘æµ‹å…‰ç…§å‚æ•°
  22          unsigned int Sun_GZ;
  23          //è®¡ç®—æœºå‚æ•°
  24          unsigned int Num1,Num2,Cal_Temp,Result,Cal_Count,Start_Flag,Com_Flag,Com_TempFlag;
  25          //BMIå‚æ•°
  26          unsigned int Weight,BMI_Temp,Hight;
  27          unsigned char BMI_Count,BMI_Flag;
  28          
  29          //é”å±å‡½æ•°ï¼Œå½“åœ¨èœå•é€‰æ‹©ç•Œé¢ï¼Œç›‘æµ‹åˆ°K1æŒ‰ä¸‹æ—¶å›åˆ°å¼€å§‹å¯†ç ç•Œé¢
  30          void Exit0()
  31          {
  32   1              Key_KeyNum=KeyNum();
  33   1              if(Key_KeyNum==1)
  34   1              {
  35   2                      LCD_ShowString(1,1,"                ");//æ¸…å±
  36   2                      LCD_ShowString(2,1,"                ");
  37   2                      Main_Flag=0;//
  38   2              }
  39   1      }
  40          //é€€å‡ºå‡½æ•°ï¼Œå½“åŠŸèƒ½é¡µé¢ï¼Œç›‘æµ‹åˆ°K1æŒ‰ä¸‹æ—¶å›åˆ°èœå•é€‰æ‹©ç•Œé¢
  41          void Exit1()
  42          {
  43   1              Key_KeyNum=KeyNum();
  44   1              if(Key_KeyNum==1)
  45   1              {
  46   2                      LCD_ShowString(1,1,"                ");
  47   2                      LCD_ShowString(2,1,"                ");
  48   2                      
  49   2                      Main_Flag=6;
  50   2              }
  51   1      }
  52          //å¼€å§‹è¾“å…¥å¯†ç 
  53          void Start_PassWord()
C51 COMPILER V9.54   MAIN                                                                  09/18/2024 17:47:02 PAGE 2   

  54          {
  55   1              LCD_ShowString(1,1,"Scanf PWD:");
  56   1              Mar_KeyNum=MatrixKey_Key();  //è·å–çŸ©é˜µé”®ç›˜é”®ç å€¼
  57   1              if(Mar_KeyNum)//å½“çŸ©é˜µé”®ç›˜æœ‰æŒ‰ä¸‹æ—¶è¿›å…¥
  58   1              {
  59   2                      //è¾“å…¥å¯†ç å…±4ä½ï¼Œæ¯æ¬¡åªèƒ½è¾“å…¥ä¸€ä¸ªæ•°å­—(0-9)ï¼ŒçŸ©é˜µé”®ç›˜K1-K10
  60   2                      if(PWD_Count<4&&Mar_KeyNum>=1&&Mar_KeyNum<=10)
  61   2                      {
  62   3                              PassWord=PassWord*10+Mar_KeyNum%10;
  63   3                              PWD_Count++;
  64   3                      }
  65   2                      //æŒ‰ä¸‹çŸ©é˜µé”®ç›˜K11ï¼Œè¾“å…¥çš„å¯†ç ä¼šæ¸…é›¶
  66   2                      else if(Mar_KeyNum==11)
  67   2                      {
  68   3                              PassWord=0;
  69   3                              PWD_Count=0;
  70   3                      }
  71   2                      //æŒ‰ä¸‹çŸ©é˜µé”®ç›˜K12ï¼Œç¡®å®šå¯†ç (åˆå§‹åŒ–ï¼š1234)
  72   2                      else if(Mar_KeyNum==12)
  73   2                      {
  74   3                              //å¯†ç æ­£ç¡®ï¼Œè¿›å…¥èœå•é¡µé¢
  75   3                              if(PassWord==1234)
  76   3                              {
  77   4                                      PassWord=0;
  78   4                                      PWD_Count=0;
  79   4                                      Main_Flag=6;
  80   4                                      LCD_ShowString(1,1,"                ");
  81   4                                      LCD_ShowString(2,1,"                ");
  82   4                              }
  83   3                              else
  84   3                              {
  85   4                                      //å¯†ç é”™è¯¯ï¼Œé‡æ–°è¾“å…¥
  86   4                                      PassWord=0;
  87   4                                      PWD_Count=0;
  88   4                                      LCD_ShowString(2,1,"PWD Mistack!");
  89   4                              }
  90   3                      }
  91   2              }
  92   1              LCD_ShowNum(1,11,PassWord,4);//å®æ—¶æ˜¾ç¤ºè¾“å…¥çš„å€¼
  93   1      }
  94          
  95          //å¤šåŠŸèƒ½èœå•é€‰æ‹©
  96          void Function_Select()
  97          {
  98   1              LCD_ShowString(1,1,"Fan Temp Sun Cal");//æ˜¾ç¤ºåŠŸèƒ½é€‰æ‹©
  99   1              LCD_ShowString(2,1,"BMI  Pick(1-5):");
 100   1              Exit0();//å®æ—¶ç›‘æµ‹ï¼Œæ˜¯å¦è¦é€€å‡ºåˆ°é”å±é¡µé¢
 101   1              Mar_KeyNum=MatrixKey_Key();
 102   1              if(Mar_KeyNum)
 103   1              {
 104   2                      if(Mar_KeyNum>=1&&Mar_KeyNum<=5)//åªæœ‰5ä¸ªåŠŸèƒ½é€‰é¡¹ï¼Œæ‰€ä»¥åªèƒ½æ˜¯1-5
 105   2                      {
 106   3                              Fun_Temp=Mar_KeyNum;//ä¸´æ—¶é€‰é¡¹å€¼
 107   3                              LCD_ShowNum(2,16,Fun_Temp,1);
 108   3                      }
 109   2                      //å½“æŒ‰ä¸‹K12ç¡®å®šæ—¶ï¼ŒæŠŠä¸´æ—¶é€‰é¡¹å€¼èµ‹ç»™Main_Flag(ä¸»çŠ¶æ€æ ‡å¿—ä½),è¿›å…¥ç›¸åº”åŠŸèƒ½é¡µé¢
 110   2                      else if(Mar_KeyNum==12)
 111   2                      {
 112   3                              if(Fun_Temp)
 113   3                              {
 114   4                                      Main_Flag=Fun_Temp;
 115   4                                      LCD_ShowString(1,1,"                ");
C51 COMPILER V9.54   MAIN                                                                  09/18/2024 17:47:02 PAGE 3   

 116   4                                      LCD_ShowString(2,1,"                ");                         
 117   4                              }
 118   3                      }
 119   2              }
 120   1      }
 121          //BMIçš„è®¡ç®—
 122          void BMI()
 123          {
 124   1              if(BMI_Flag==0)
 125   1              {
 126   2                      LCD_ShowString(1,1,"BMI");
 127   2                      LCD_ShowString(1,10,"H:");
 128   2                      LCD_ShowString(2,10,"W:");
 129   2                      LCD_ShowString(1,15,"CM");
 130   2                      LCD_ShowString(2,15,"KG");
 131   2                      Mar_KeyNum=MatrixKey_Key();
 132   2                      Exit1();//å®æ—¶ç›‘æµ‹ï¼Œæ˜¯å¦è¦é€€å‡ºåˆ°èœå•é€‰æ‹©é¡µé¢
 133   2                      if(Mar_KeyNum)
 134   2                      {
 135   3                              //è¾“å…¥æ•°å­—æœ€å¤š3ä½ï¼Œæ¯æ¬¡åªèƒ½è¾“å…¥ä¸€ä¸ªæ•°å­—(0-9)ï¼ŒçŸ©é˜µé”®ç›˜K1-K10
 136   3                              if(BMI_Count<3&&Mar_KeyNum>=1&&Mar_KeyNum<=10)
 137   3                              {
 138   4                                      BMI_Temp=BMI_Temp*10+Mar_KeyNum%10;
 139   4                                      BMI_Count++;
 140   4                              }
 141   3                              else if(Mar_KeyNum==11)//æ¸…é›¶
 142   3                              {
 143   4                                      BMI_Temp=0;
 144   4                                      BMI_Count=0;
 145   4                              }
 146   3                              //ç¡®å®šæŒ‰é”®ï¼Œå½“çŸ©é˜µé”®ç›˜æŒ‰ä¸‹K12æ—¶
 147   3                              else if(Mar_KeyNum==12)
 148   3                              {
 149   4                                      //å½“èº«é«˜ä¸º0ï¼ŒTempå€¼ç»™èº«é«˜
 150   4                                      if(Hight==0)
 151   4                                      {
 152   5                                              Hight=BMI_Temp;
 153   5                                              LCD_ShowNum(1,12,Hight,3);
 154   5                                              BMI_Temp=0;
 155   5                                              BMI_Count=0;
 156   5                                      }
 157   4                                      //å½“èº«é«˜ä¸º0ï¼ŒTempå€¼ç»™èº«é«˜
 158   4                                      else if(Weight==0)
 159   4                                      {
 160   5                                              Weight=BMI_Temp;
 161   5                                              BMI_Flag=1;
 162   5                                              LCD_ShowString(1,1,"                ");
 163   5                                              LCD_ShowString(2,1,"                "); 
 164   5                                              LCD_ShowString(1,1,"BMI:");     
 165   5                                              LCD_ShowString(2,1,"Result:");
 166   5                                      }
 167   4                              }
 168   3                      }
 169   2                      if(Hight==0)
 170   2                      {
 171   3                              LCD_ShowNum(1,12,BMI_Temp,3);
 172   3                      }
 173   2                      else if(Weight==0)
 174   2                      {
 175   3                              LCD_ShowNum(2,12,BMI_Temp,3);
 176   3                      }
 177   2              }
C51 COMPILER V9.54   MAIN                                                                  09/18/2024 17:47:02 PAGE 4   

 178   1              if(BMI_Flag)
 179   1              {       
 180   2                      double H=(double)(Hight)/100;
 181   2                      double Result=Weight/(H*H);
 182   2                      Exit1();
 183   2                      LCD_ShowNum(1,5,Result,2);
 184   2                      LCD_ShowChar(1,7,'.');
 185   2                      LCD_ShowNum(1,8,(int)(Result*100)%100,2);
 186   2                      if(Result>18.5&&Result<24.9)
 187   2                      {
 188   3                              LCD_ShowString(2,8,"Normal");
 189   3                      }
 190   2                      else if(Result<18.5)
 191   2                      {
 192   3                              LCD_ShowString(2,8,"Thin!");
 193   3                      }
 194   2                      else
 195   2                      {
 196   3                              LCD_ShowString(2,8,"Chubby!!");
 197   3                      }
 198   2                      Mar_KeyNum=MatrixKey_Key();
 199   2                      if(Mar_KeyNum==11)
 200   2                      {
 201   3                              LCD_ShowString(1,1,"                ");
 202   3                              LCD_ShowString(2,1,"                "); 
 203   3                              Hight=0;
 204   3                              Weight=0;
 205   3                              BMI_Temp=0;
 206   3                              BMI_Count=0;
 207   3                              BMI_Flag=0;
 208   3                      }
 209   2              }
 210   1      }
 211          //è®¡ç®—å™¨
 212          void Cal()
 213          {
 214   1              Exit1();
 215   1              LCD_ShowString(1,1,"NUM1 NUM2 Result");
 216   1              Mar_KeyNum=MatrixKey_Key();
 217   1              if(Mar_KeyNum)
 218   1              {
 219   2                      if(Cal_Count<3&&Mar_KeyNum>=1&&Mar_KeyNum<=10)
 220   2                      {
 221   3                              Cal_Temp=Cal_Temp*10+Mar_KeyNum%10;
 222   3                              Start_Flag=1;
 223   3                              Cal_Count++;
 224   3                      }
 225   2                      else if(Mar_KeyNum==11)
 226   2                      {
 227   3                              Cal_Temp=0;
 228   3                              Cal_Count=0;
 229   3                              if(Com_Flag&&Num1&&Num2)
 230   3                              {
 231   4                                      LCD_ShowString(2,1,"                "); 
 232   4                                      Num1=0,Num2=0,Cal_Temp=0,Cal_Count=0,Start_Flag=0,Com_TempFlag=0,Com_Flag=0;
 233   4                              }
 234   3                      }
 235   2                      else if(Mar_KeyNum==12)
 236   2                      {
 237   3                              if(Num1==0)
 238   3                              {
 239   4                                      Num1=Cal_Temp;
C51 COMPILER V9.54   MAIN                                                                  09/18/2024 17:47:02 PAGE 5   

 240   4                                      LCD_ShowNum(2,1,Num1,3);                                
 241   4                                      Start_Flag=0;
 242   4                              }
 243   3                              else if(Num1&&Com_Flag==0)
 244   3                              {
 245   4                                      Com_Flag=Com_TempFlag;
 246   4                                      Cal_Temp=0,Cal_Count=0;
 247   4                              }
 248   3                              else if(Com_Flag&&Num2==0)
 249   3                              {
 250   4                                      Num2=Cal_Temp;
 251   4                                      LCD_ShowNum(2,7,Num2,3);
 252   4                              }
 253   3                              if(Com_Flag&&Num1&&Num2)
 254   3                              {
 255   4                                      LCD_ShowChar(2,10,'=');
 256   4                                      if(Com_Flag==13){LCD_ShowNum(2,11,(Num1+Num2),4);}
 257   4                                      if(Com_Flag==14){LCD_ShowSignedNum(2,11,(Num1-Num2),3);}
 258   4                                      if(Com_Flag==15){LCD_ShowNum(2,11,(Num1*Num2),6);}
 259   4                                      if(Com_Flag==16){LCD_ShowNum(2,11,(Num1/Num2),3);}
 260   4                              }
 261   3                      }
 262   2                      else if(Num1&&Mar_KeyNum>=13&&Mar_KeyNum<=16)
 263   2                      {
 264   3                              if(Mar_KeyNum==13){Com_TempFlag=13;LCD_ShowChar(2,5,'+');}
 265   3                              if(Mar_KeyNum==14){Com_TempFlag=14;LCD_ShowChar(2,5,'-');}
 266   3                              if(Mar_KeyNum==15){Com_TempFlag=15;LCD_ShowChar(2,5,'*');}//ç”±äº51å•ç‰‡æœºä¹˜æ³•è¿ç®—æœ€é«˜ä½16ä½
             -å¤„ç†ï¼Œæ‰€ä»¥å¦‚æœè®¡ç®—ç»“æœè¶…è¿‡65536å°†ä¼šä»1å¼€å§‹ç®—èµ·
 267   3                              if(Mar_KeyNum==16){Com_TempFlag=16;LCD_ShowChar(2,5,'/');}
 268   3                      }
 269   2              }
 270   1              if(Start_Flag&&Num1==0)
 271   1              {
 272   2                      LCD_ShowNum(2,1,Cal_Temp,3);
 273   2              }
 274   1              if(Com_Flag&&Num2==0&&Start_Flag)
 275   1              {
 276   2                      LCD_ShowNum(2,7,Cal_Temp,3);
 277   2              }
 278   1      }
 279          //å®æ—¶ç›‘æµ‹å…‰ç…§ï¼Œåˆ¤æ–­ç™½å¤©é»‘å¤œ
 280          void Sun()
 281          {
 282   1              LCD_ShowString(1,1,"RG:");
 283   1              Sun_GZ=XPT2406_ReadAD(0XA4);
 284   1              LCD_ShowNum(1,4,Sun_GZ,3);
 285   1              while(Main_Flag==3&&Sun_GZ<=8)
 286   1              {
 287   2                      Exit1();
 288   2                      Sun_GZ=XPT2406_ReadAD(0XA4);
 289   2                      LCD_ShowNum(1,4,Sun_GZ,3);
 290   2                      LCD_ShowString(2,1,"now is night!");
 291   2              }
 292   1              LCD_ShowString(2,1,"                "); 
 293   1              while(Main_Flag==3&&Sun_GZ>8)
 294   1              {
 295   2                      Exit1();
 296   2                      Sun_GZ=XPT2406_ReadAD(0XA4);
 297   2                      LCD_ShowNum(1,4,Sun_GZ,3);
 298   2                      LCD_ShowString(2,1,"now is day!");
 299   2              }
 300   1      }
C51 COMPILER V9.54   MAIN                                                                  09/18/2024 17:47:02 PAGE 6   

 301          //å®æ—¶ç›‘æµ‹æ¸©åº¦
 302          void Temp()
 303          {
 304   1              LCD_ShowString(1,1,"T:");
 305   1              while(Main_Flag==2)
 306   1              {
 307   2                      Exit1();
 308   2                      DS18B20_ConverT();
 309   2                      T=DS18B20_ReadT();
 310   2                      if(T<0)
 311   2                      {
 312   3                              LCD_ShowChar(1,3,'-');
 313   3                              T=-T;
 314   3                      }
 315   2                      else
 316   2                      {
 317   3                              LCD_ShowChar(1,3,'+');
 318   3                      }
 319   2                      LCD_ShowNum(1,4,T,3);
 320   2                      LCD_ShowChar(1,7,'.');
 321   2                      LCD_ShowNum(1,8,(unsigned long)(T*100)%100,2);
 322   2              }
 323   1      }
 324          //è°ƒé€Ÿé£æ‰‡
 325          void Fan()
 326          {
 327   1              Timer1_Init();
 328   1              Exit1();
 329   1              Mar_KeyNum=MatrixKey_Key();
 330   1              if(Mar_KeyNum==10||(Mar_KeyNum>=1&&Mar_KeyNum<=3))
 331   1              {
 332   2                      if(Mar_KeyNum==10){Fan_Speed=0,Compare=0;}
 333   2                      if(Mar_KeyNum==1){Fan_Speed=1,Compare=50;}
 334   2                      if(Mar_KeyNum==2){Fan_Speed=2,Compare=75;}
 335   2                      if(Mar_KeyNum==3){Fan_Speed=3,Compare=100;}
 336   2              }
 337   1              LCD_ShowString(1,1,"Fan Speed:");
 338   1              LCD_ShowNum(1,11,Fan_Speed,1);
 339   1      }
 340          
 341          
 342          void main()
 343          {
 344   1              LCD_Init();
 345   1              Timer0_Init();
 346   1              
 347   1              while(1)
 348   1              {
 349   2                      if(Main_Flag==0)
 350   2                      {
 351   3                              Start_PassWord();
 352   3                      }
 353   2                      else if(Main_Flag==1)
 354   2                      {
 355   3                              Fan();
 356   3                      }
 357   2                      else if(Main_Flag==2)
 358   2                      {
 359   3                              Temp();
 360   3                      }
 361   2                      else if(Main_Flag==3)
 362   2                      {
C51 COMPILER V9.54   MAIN                                                                  09/18/2024 17:47:02 PAGE 7   

 363   3                              Sun();
 364   3                      }
 365   2                      else if(Main_Flag==4)
 366   2                      {
 367   3                              Cal();
 368   3                      }
 369   2                      else if(Main_Flag==5)
 370   2                      {
 371   3                              BMI();
 372   3                      }       
 373   2                      else if(Main_Flag==6)
 374   2                      {
 375   3                              Fan_Speed=0,Compare=0,ET1 = 0;//å½“ä»é£æ‰‡åŠŸèƒ½å‡ºæ¥æ—¶ï¼Œé£é€Ÿè°ƒä¸º0ï¼Œå…³é—­å®šæ—¶å™¨1
 376   3                              Num1=0,Num2=0,Cal_Temp=0,Cal_Count=0,Start_Flag=0,Com_Flag=0;//å½“ä»è®¡ç®—æœºåŠŸèƒ½å‡ºæ¥æ—¶ï¼Œå‚æ•°å
             -ˆå§‹åŒ–ä¸º0
 377   3                              Weight=0,BMI_Temp=0,Hight=0,BMI_Count=0,BMI_Flag=0;
 378   3                              Function_Select();
 379   3                      }
 380   2              }
 381   1      }
 382          
 383          void Timer0_Routine() interrupt 1
 384          {
 385   1              static unsigned char T0Count1;
 386   1              static unsigned char T0Count2;
 387   1              T0Count1++;
 388   1              T0Count2++;
 389   1              TL0 = 0x18;             //è®¾ç½®å®šæ—¶åˆå€¼
 390   1              TH0 = 0xFC;             //è®¾ç½®å®šæ—¶åˆå€¼
 391   1              
 392   1              if(T0Count1>=20)
 393   1              {
 394   2                      MartrixKey_Loop();
 395   2              }
 396   1              if(T0Count2>=60)
 397   1              {
 398   2                      Key_Loop();
 399   2              }
 400   1              
 401   1      }
 402          
 403          void Timer1_Routine() interrupt 3  //ä¸­æ–­å‡½æ•°
 404          {
 405   1              static unsigned int T1Count;
 406   1              T1Count++;
 407   1              T1Count%=100;
 408   1              TL1 = 0x9C;                             //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 409   1              TH1 = 0xFF;                             //è®¾ç½®å®šæ—¶åˆå§‹å€¼
 410   1              if(T1Count<Compare)     
 411   1              {
 412   2                      Motor=1;           
 413   2              }
 414   1              else
 415   1              {
 416   2                      Motor=0;
 417   2              }
 418   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2292    ----
   CONSTANT SIZE    =    186    ----
C51 COMPILER V9.54   MAIN                                                                  09/18/2024 17:47:02 PAGE 8   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     43       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
